<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Registro Personal</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Fraunces:opsz,wght@9..144,400;9..144,600;9..144,700&family=Space+Grotesk:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="bg"></div>
    <main class="app">
      <header class="hero">
        <div class="hero-top">
          <div>
            <h1>Registro Personal</h1>
            <p id="appDate" class="hero-date">-</p>
          </div>
          <div id="headerMenu" class="header-menu hidden">
            <button id="menuToggle" class="ghost menu-toggle" type="button" aria-label="Abrir menu" aria-expanded="false">
              <span aria-hidden="true">☰</span>
            </button>
            <div id="headerMenuPanel" class="menu-panel hidden" role="menu" aria-label="Menu principal">
              <button class="menu-item" type="button" role="menuitem" data-menu-action="logout">Salir</button>
              <button class="menu-item" type="button" role="menuitem" data-menu-action="export">Exportar datos</button>
              <button class="menu-item" type="button" role="menuitem" data-menu-action="settings">Configuracion</button>
            </div>
          </div>
        </div>
        <nav class="tab-nav hidden" id="mainTabs" aria-label="Secciones de la app">
          <button type="button" class="tab-btn is-active" data-tab-target="todayPanel">
            <span class="tab-label">Habitos</span>
            <span class="tab-inline" id="tabHabitsProgress">0/0</span>
          </button>
          <button type="button" class="tab-btn" data-tab-target="weightPanel">
            <span class="tab-label">Peso</span>
          </button>
          <button type="button" class="tab-btn" data-tab-target="medicationPanel">
            <span class="tab-label">Medicaciones</span>
            <span id="tabMedicationDot" class="med-dot is-red" aria-hidden="true"></span>
            <span id="tabMedicationStatusText" class="sr-only">Sin registros</span>
          </button>
          <button type="button" class="tab-btn" data-tab-target="reportsPanel">
            <span class="tab-label">Informes</span>
          </button>
        </nav>
      </header>

      <div id="estadoApp" class="status-banner"></div>

      <section class="card" id="loginCard">
        <div class="auth">
          <div class="auth-info">
            <h2>Acceso</h2>
            <p class="subtitle">Inicia sesion para ver y guardar tus datos.</p>
          </div>
          <div class="auth-form">
            <div class="field">
              <label for="email">Email</label>
              <input id="email" type="email" placeholder="tu@email.com" autocomplete="username" />
            </div>
            <div class="field">
              <label for="password">Clave</label>
              <input id="password" type="password" placeholder="••••••••" autocomplete="current-password" />
            </div>
            <button id="login" class="primary">Entrar</button>
          </div>
        </div>
      </section>

      <div id="zonaPrivada" class="hidden">
        <section id="todayPanel" class="panel is-active">
          <section class="card">
            <div class="table-header">
              <h2>Habitos de hoy</h2>
              <span id="habitCounter" class="chip">0 habitos</span>
            </div>
            <div class="today-summary">
              <label class="field date-field" for="habitDate">
                <span>Fecha</span>
                <input id="habitDate" type="date" />
              </label>
              <p id="habitSummary" class="hint">Sin registro diario aun.</p>
            </div>
            <div class="table-wrap">
              <table>
                <thead>
                  <tr>
                    <th>Habito</th>
                    <th>Seguimiento diario</th>
                  </tr>
                </thead>
                <tbody id="habitsTable">
                  <tr class="empty">
                    <td colspan="2">Aun no hay habitos creados.</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </section>

          <section class="card">
            <details id="newHabitDetails">
              <summary>+ Nuevo habito</summary>
              <div class="habit-form">
                <div class="field">
                  <label for="habitName">Nombre</label>
                  <input id="habitName" type="text" placeholder="Ej: Ejercicios de fuerza" />
                </div>
                <div class="field">
                  <label for="habitDescription">Descripcion (opcional)</label>
                  <input id="habitDescription" type="text" placeholder="Ej: 20-30 min al final del dia" />
                </div>
                <button id="createHabit" class="primary">Crear habito</button>
              </div>
            </details>
          </section>
        </section>

        <section id="weightPanel" class="panel hidden">
          <section class="card">
            <div class="table-header">
              <h2>Registrar peso</h2>
            </div>
            <div class="form-row">
              <div class="field">
                <label for="peso">Peso (kg)</label>
                <input id="peso" type="number" inputmode="decimal" step="0.1" min="0" placeholder="Ej: 72.4" />
              </div>
              <div class="field">
                <label>Fecha y hora</label>
                <div class="readonly" id="fechaActual">-</div>
              </div>
              <button id="guardar" class="primary">Registrar</button>
            </div>
            <p class="hint">La fecha y hora se guarda automaticamente al momento de registrar.</p>
          </section>

          <section class="card table-card">
            <div class="table-header">
              <h2>Historial de peso</h2>
              <span id="contador" class="chip">0 registros</span>
            </div>
            <div class="table-wrap">
              <table>
                <thead>
                  <tr>
                    <th>Fecha y hora</th>
                    <th>Peso (kg)</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody id="tabla">
                  <tr class="empty">
                    <td colspan="3">Aun no hay registros.</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </section>

          <section class="card">
            <details id="weightToolsDetails">
              <summary>Herramientas de peso</summary>
              <div class="tools weight-tools">
                <div class="tool-group">
                  <button id="exportar" class="secondary">Exportar CSV</button>
                  <label class="file-btn" for="importar">
                    Importar CSV
                    <input id="importar" type="file" accept=".csv,text/csv" />
                  </label>
                </div>
                <div class="tool-group">
                  <button id="limpiar" class="danger">Borrar todo</button>
                </div>
              </div>
              <p class="hint">El CSV usa el formato: <span class="mono">timestamp,weight</span> (timestamp en ISO 8601).</p>
            </details>
          </section>
        </section>

        <section id="medicationPanel" class="panel hidden">
          <section class="card">
            <div class="table-header">
              <h2>Medicaciones de hoy</h2>
              <span id="medTodayBadge" class="chip">0 programadas pendientes</span>
            </div>

            <div class="med-block">
              <h3>Programadas</h3>
              <div id="medScheduledList" class="med-list">
                <div class="empty-message">No hay medicaciones programadas activas.</div>
              </div>
            </div>

            <div class="med-block">
              <h3>A demanda (extra)</h3>
              <div id="medPrnList" class="med-list">
                <div class="empty-message">No hay medicaciones a demanda activas.</div>
              </div>
            </div>
          </section>

          <section class="card">
            <div class="table-header">
              <h2>Historial</h2>
            </div>
            <div class="med-filters">
              <label class="field">
                <span>Medicacion</span>
                <select id="medHistoryMedication">
                  <option value="">Todas</option>
                </select>
              </label>
              <label class="field">
                <span>Tipo</span>
                <select id="medHistorySource">
                  <option value="">Todos</option>
                  <option value="scheduled">Programada</option>
                  <option value="extra">Extra</option>
                </select>
              </label>
              <label class="field">
                <span>Desde</span>
                <input id="medHistoryFrom" type="date" />
              </label>
              <label class="field">
                <span>Hasta</span>
                <input id="medHistoryTo" type="date" />
              </label>
              <button id="medHistoryApply" class="ghost" type="button">Aplicar filtros</button>
            </div>
            <div id="medHistoryList" class="med-history-list">
              <div class="empty-message">Aun no hay eventos de medicacion.</div>
            </div>
          </section>

          <section class="card">
            <details id="medCreateDetails">
              <summary>Registrar nuevo tratamiento</summary>
              <div class="med-create-form">
                <label class="field">
                  <span>Medicacion</span>
                  <input id="medCreateName" type="text" placeholder="Ej: Ibuprofeno" />
                </label>
                <label class="field">
                  <span>Tipo</span>
                  <select id="medCreateType">
                    <option value="scheduled">Programada</option>
                    <option value="prn">A demanda (extra)</option>
                  </select>
                </label>
                <label class="field" id="medCreateWindowField">
                  <span>Ventana</span>
                  <select id="medCreateWindow">
                    <option value="morning">Manana</option>
                    <option value="afternoon">Tarde</option>
                    <option value="night">Noche</option>
                  </select>
                </label>
                <label class="field">
                  <span>Inicio</span>
                  <input id="medCreateStart" type="date" />
                </label>
                <label class="field med-create-notes">
                  <span>Notas (opcional)</span>
                  <input id="medCreateNotes" type="text" placeholder="Ej: despues de comer" />
                </label>
                <button id="medCreateSubmit" class="primary" type="button">Guardar tratamiento</button>
              </div>
            </details>
          </section>
        </section>

        <section id="reportsPanel" class="panel hidden">
          <section class="card">
            <div class="table-header">
              <h2>Informes semanales</h2>
              <button id="reportGenerateNow" class="secondary" type="button">Generar ahora</button>
            </div>
            <p class="hint">Se genera automaticamente los lunes a las 08:00 (Europe/Madrid).</p>
            <div id="reportsList" class="reports-list">
              <div class="empty-message">Aun no hay informes generados.</div>
            </div>
          </section>

          <section class="card">
            <div class="table-header">
              <h2>Detalle del informe</h2>
            </div>
            <div id="reportDetail" class="report-detail">
              <div class="empty-message">Selecciona un informe para ver el detalle.</div>
            </div>
          </section>
        </section>
      </div>

      <div id="mensaje" class="message" role="status" aria-live="polite"></div>
    </main>

    <script src="app.js?v=weekly-reports-20260222"></script>
  </body>
</html>
